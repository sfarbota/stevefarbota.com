function calculateTotalTagCount(){var e=[stackOverflowTagCount,jsFiddleTagCount],t=0;$.each(e,function(){t+=this}),totalTagCount=t}function getJSFiddleTags(){$.getJSON("http://jsfiddle.net/api/user/"+jsFiddleUserId+"/demo/list.json?sort=date&order=desc&limit="+jsFiddleTagCount+"&callback=?",function(e){jsFiddleTagCount=e.list.length,calculateTotalTagCount();var t=[];$.each(e.list,function(e,n){t.push(n.latest_version)});var n=getMinAndMaxValues(t);$.each(e.list,function(e,t){createBall(n,t.latest_version,t.title,t.description)})})}function getStackOverflowTags(e){e=e||1,stackOverflowMaxTagAgeInMonths>=e?$.getJSON("https://api.stackexchange.com/2.2/users/"+stackOverflowUserId+"/tags?site=stackoverflow&sort=popular&order=desc&fromdate="+Math.round((new Date).setDate((new Date).getDate()-30*e)/1e3)+"&pagesize="+stackOverflowTagCount+"&page=1",function(t){if(0===t.items.length)getStackOverflowTags(e+1);else{stackOverflowTagCount=t.items.length,calculateTotalTagCount();var n=[],r=[];$.each(t.items,function(e,t){n.push(t.name),r.push(t.count)});var a=[];$.getJSON("https://api.stackexchange.com/2.2/tags/"+n.join(";")+"/wikis?site=stackoverflow",function(e){$.each(e.items,function(e,t){a[t.tag_name]=t.excerpt})});var o=getMinAndMaxValues(r);$.each(t.items,function(e,t){createBall(o,t.count,t.name.replace(/\-/g," "),a[t.name])})}}):stackOverflowTagCount=0}function getMinAndMaxValues(e){var t=Number.MAX_VALUE,n=Number.MIN_VALUE;return $.each(e,function(e,r){t>r&&(t=r),r>n&&(n=r)}),[t,n]}function createBall(e,t,n,r,a){a=a||0;var o="/images/current-areas-of-focus/"+n.toLowerCase().replace(/[^a-zA-Z\d]+/g,"-")+"."+imageFileExtensions[a];$.get(o).done(function(){foundImage=!0;var a=new Image(100,100);a.src=o,a.onload=function(){for(var i=(new ColorThief).getPalette(a,5,10),l=null,u=20,s=0;null===l&&s<i.length;){var c=i[s];Math.abs(c[0]-c[1])<u&&Math.abs(c[0]-c[2])<u&&Math.abs(c[1]-c[2])<u||(l=c),s++}l=null===l?randomColor({hue:"random",luminosity:"bright",count:1}):"rgb("+l.join(",")+")",pushBall(e,t,l,o,n,r),checkIfAllBallsHaveBeenPushed()}}).fail(function(){a<imageFileExtensions.length-1?createBall(e,t,n,r,a+1):(pushBall(e,t,randomColor({hue:"random",luminosity:"bright",count:1}),null,n,r),checkIfAllBallsHaveBeenPushed())})}function pushBall(e,t,n,r,a,o){var i=e[0],l=e[1],u=minBallPercentageOfContainerR*containerR,s=maxBallPercentageOfContainerR*containerR,c=s-u,f=l-i,g=1,h=i==l?l>g?s:u:c*(t-i)/f+u;balls.push(getBall(containerR*(Math.random()+.5),containerR*(Math.random()+.5),(Math.random()<.5?-1:1)*speed,(Math.random()<.5?-1:1)*speed,h,n,r,a,o))}function checkIfAllBallsHaveBeenPushed(){balls.length==totalTagCount&&(initDrawing(),setInterval(moveBalls,10))}function getBall(e,t,n,r,a,o,i,l,u){var s={x:e,y:t,dx:n,dy:r,r:a,color:o,image:i,imageObject:i,title:l,description:u};return s}function initDrawing(){svg.style.width=2*containerR+"px",svg.style.height=2*containerR+"px",svg.style.borderRadius=containerR+"px",svg.style.background="#eee",svg.style.font=textSize+"px Arial";for(var e=0;e<balls.length;e++){var t=balls[e],n=document.createElementNS(svgNamespace,"circle");if(n.id="ball-"+e,n.setAttributeNS(null,"cx",t.x),n.setAttributeNS(null,"cy",t.y),n.setAttributeNS(null,"r",t.r),n.setAttributeNS(null,"fill",t.color),n.style.cursor="pointer",null!==t.image){var r=document.createElementNS(svgNamespace,"image");r.id="ball-"+e+"-image",r.setAttributeNS("http://www.w3.org/1999/xlink","href",t.image),r.setAttributeNS(null,"height",1.4*t.r),r.setAttributeNS(null,"width",1.4*t.r),r.setAttributeNS(null,"x",t.x-.7*t.r),r.setAttributeNS(null,"y",t.y-.7*t.r),r.style.cursor="pointer",$("#svg-wrapper").append(n),$("#svg-wrapper").append(r)}else{var a=document.createElementNS(svgNamespace,"text");a.id="ball-"+e+"-text",a.setAttributeNS(null,"x",t.x),a.setAttributeNS(null,"y",t.y),a.setAttributeNS(null,"fill","#000"),a.style.cursor="pointer",$("#svg-wrapper").append(n),$("#svg-wrapper").append(a);for(var o=t.title.toUpperCase().split(" "),i=0;i<o.length;i++){var l=document.createElementNS(svgNamespace,"tspan");l.setAttributeNS(null,"dy",textLineSpacing+"px"),l.textContent=o[i],$("#ball-"+e+"-text").append(l),l.setAttributeNS(null,"x",t.x-l.getComputedTextLength()/2)}a.setAttributeNS(null,"x",t.x-a.getComputedTextLength()/2),a.setAttributeNS(null,"y",t.y-(textSize+(o.length-1)*textLineSpacing)/2)}}}function moveBalls(){for(var e=0;e<balls.length;e++)$("#ball-"+e).filter(function(){return $(this).is(":hover")}).length||$("#ball-"+e+"-image").filter(function(){return $(this).is(":hover")}).length||$("#ball-"+e+"-text").filter(function(){return $(this).is(":hover")}).length||moveBall(e)}function moveBall(e){ball=balls[e],ball.x+=ball.dx,ball.y+=ball.dy;var t=ball.x-containerR,n=ball.y-containerR,r=Math.sqrt(t*t+n*n);if(r>=containerR-ball.r){var a=r,o=t/a,i=n/a,l=-i,u=o,s=-(o*ball.dx+i*ball.dy),c=l*ball.dx+u*ball.dy;ball.dx=s*o+c*l,ball.dy=s*i+c*u}var f=$("#ball-"+e)[0];if(f.setAttributeNS(null,"cx",ball.x),f.setAttributeNS(null,"cy",ball.y),null!==ball.image){var g=$("#ball-"+e+"-image")[0];g.setAttributeNS(null,"x",ball.x-.7*ball.r),g.setAttributeNS(null,"y",ball.y-.7*ball.r)}else{for(var h=$("#ball-"+e+"-text")[0],v=ball.title.toUpperCase().split(" "),p=0;p<v.length;p++){var d=h.children[p];d.setAttributeNS(null,"x",ball.x-d.getComputedTextLength()/2)}h.setAttributeNS(null,"x",ball.x-h.getComputedTextLength()/2),h.setAttributeNS(null,"y",ball.y-(textSize+(v.length-1)*textLineSpacing)/2)}}var CanvasImage=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.width,this.height=this.canvas.height=e.height,this.context.drawImage(e,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(e){this.context.putImageData(e,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(e,t){var n=this.getPalette(e,5,t),r=n[0];return r},ColorThief.prototype.getPalette=function(e,t,n){"undefined"==typeof t&&(t=10),("undefined"==typeof n||1>n)&&(n=10);for(var r,a,o,i,l,u=new CanvasImage(e),s=u.getImageData(),c=s.data,f=u.getPixelCount(),g=[],h=0;f>h;h+=n)r=4*h,a=c[r+0],o=c[r+1],i=c[r+2],l=c[r+3],l>=125&&(a>250&&o>250&&i>250||g.push([a,o,i]));var v=MMCQ.quantize(g,t),p=v?v.palette():null;return u.removeCanvas(),p},!pv)var pv={map:function(e,t){var n={};return t?e.map(function(e,r){return n.index=r,t.call(n,e)}):e.slice()},naturalOrder:function(e,t){return t>e?-1:e>t?1:0},sum:function(e,t){var n={};return e.reduce(t?function(e,r,a){return n.index=a,e+t.call(n,r)}:function(e,t){return e+t},0)},max:function(e,t){return Math.max.apply(null,t?pv.map(e,t):e)}};var MMCQ=function(){function e(e,t,n){return(e<<2*u)+(t<<u)+n}function t(e){function t(){n.sort(e),r=!0}var n=[],r=!1;return{push:function(e){n.push(e),r=!1},peek:function(e){return r||t(),void 0===e&&(e=n.length-1),n[e]},pop:function(){return r||t(),n.pop()},size:function(){return n.length},map:function(e){return n.map(e)},debug:function(){return r||t(),n}}}function n(e,t,n,r,a,o,i){var l=this;l.r1=e,l.r2=t,l.g1=n,l.g2=r,l.b1=a,l.b2=o,l.histo=i}function r(){this.vboxes=new t(function(e,t){return pv.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function a(t){var n,r,a,o,i=1<<3*u,l=new Array(i);return t.forEach(function(t){r=t[0]>>s,a=t[1]>>s,o=t[2]>>s,n=e(r,a,o),l[n]=(l[n]||0)+1}),l}function o(e,t){var r,a,o,i=1e6,l=0,u=1e6,c=0,f=1e6,g=0;return e.forEach(function(e){r=e[0]>>s,a=e[1]>>s,o=e[2]>>s,i>r?i=r:r>l&&(l=r),u>a?u=a:a>c&&(c=a),f>o?f=o:o>g&&(g=o)}),new n(i,l,u,c,f,g,t)}function i(t,n){function r(e){var t,r,a,o,i,l=e+"1",s=e+"2",c=0;for(u=n[l];u<=n[s];u++)if(v[u]>h/2){for(a=n.copy(),o=n.copy(),t=u-n[l],r=n[s]-u,i=r>=t?Math.min(n[s]-1,~~(u+r/2)):Math.max(n[l],~~(u-1-t/2));!v[i];)i++;for(c=p[i];!c&&v[i-1];)c=p[--i];return a[s]=i,o[l]=a[s]+1,[a,o]}}if(n.count()){var a=n.r2-n.r1+1,o=n.g2-n.g1+1,i=n.b2-n.b1+1,l=pv.max([a,o,i]);if(1==n.count())return[n.copy()];var u,s,c,f,g,h=0,v=[],p=[];if(l==a)for(u=n.r1;u<=n.r2;u++){for(f=0,s=n.g1;s<=n.g2;s++)for(c=n.b1;c<=n.b2;c++)g=e(u,s,c),f+=t[g]||0;h+=f,v[u]=h}else if(l==o)for(u=n.g1;u<=n.g2;u++){for(f=0,s=n.r1;s<=n.r2;s++)for(c=n.b1;c<=n.b2;c++)g=e(s,u,c),f+=t[g]||0;h+=f,v[u]=h}else for(u=n.b1;u<=n.b2;u++){for(f=0,s=n.r1;s<=n.r2;s++)for(c=n.g1;c<=n.g2;c++)g=e(s,c,u),f+=t[g]||0;h+=f,v[u]=h}return v.forEach(function(e,t){p[t]=h-e}),r(l==a?"r":l==o?"g":"b")}}function l(e,n){function l(e,t){for(var n,r=1,a=0;c>a;)if(n=e.pop(),n.count()){var o=i(u,n),l=o[0],s=o[1];if(!l)return;if(e.push(l),s&&(e.push(s),r++),r>=t)return;if(a++>c)return}else e.push(n),a++}if(!e.length||2>n||n>256)return!1;var u=a(e),s=0;u.forEach(function(){s++});var g=o(e,u),h=new t(function(e,t){return pv.naturalOrder(e.count(),t.count())});h.push(g),l(h,f*n);for(var v=new t(function(e,t){return pv.naturalOrder(e.count()*e.volume(),t.count()*t.volume())});h.size();)v.push(h.pop());l(v,n-v.size());for(var p=new r;v.size();)p.push(v.pop());return p}var u=5,s=8-u,c=1e3,f=.75;return n.prototype={volume:function(e){var t=this;return(!t._volume||e)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var n=this,r=n.histo;if(!n._count_set||t){var a,o,i,l=0;for(a=n.r1;a<=n.r2;a++)for(o=n.g1;o<=n.g2;o++)for(i=n.b1;i<=n.b2;i++)index=e(a,o,i),l+=r[index]||0;n._count=l,n._count_set=!0}return n._count},copy:function(){var e=this;return new n(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(t){var n=this,r=n.histo;if(!n._avg||t){var a,o,i,l,s,c=0,f=1<<8-u,g=0,h=0,v=0;for(o=n.r1;o<=n.r2;o++)for(i=n.g1;i<=n.g2;i++)for(l=n.b1;l<=n.b2;l++)s=e(o,i,l),a=r[s]||0,c+=a,g+=a*(o+.5)*f,h+=a*(i+.5)*f,v+=a*(l+.5)*f;c?n._avg=[~~(g/c),~~(h/c),~~(v/c)]:n._avg=[~~(f*(n.r1+n.r2+1)/2),~~(f*(n.g1+n.g2+1)/2),~~(f*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(e){var t=this,n=e[0]>>s;return gval=e[1]>>s,bval=e[2]>>s,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},r.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,n=0;n<t.size();n++)if(t.peek(n).vbox.contains(e))return t.peek(n).color;return this.nearest(e)},nearest:function(e){for(var t,n,r,a=this.vboxes,o=0;o<a.size();o++)n=Math.sqrt(Math.pow(e[0]-a.peek(o).color[0],2)+Math.pow(e[1]-a.peek(o).color[1],2)+Math.pow(e[2]-a.peek(o).color[2],2)),(t>n||void 0===t)&&(t=n,r=a.peek(o).color);return r},forcebw:function(){var e=this.vboxes;e.sort(function(e,t){return pv.naturalOrder(pv.sum(e.color),pv.sum(t.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var n=e.length-1,r=e[n].color;r[0]>251&&r[1]>251&&r[2]>251&&(e[n].color=[255,255,255])}},{quantize:l}}();!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("object"==typeof exports){var n=t();"object"==typeof module&&module&&module.exports&&(exports=module.exports=n),exports.randomColor=n}else e.randomColor=t()}(this,function(){function e(e){var t=o(e.hue),n=u(t);return 0>n&&(n=360+n),n}function t(e,t){if("random"===t.luminosity)return u([0,100]);if("monochrome"===t.hue)return 0;var n=i(e),r=n[0],a=n[1];switch(t.luminosity){case"bright":r=55;break;case"dark":r=a-10;break;case"light":a=55}return u([r,a])}function n(e,t,n){var r=a(e,t),o=100;switch(n.luminosity){case"dark":o=r+20;break;case"light":r=(o+r)/2;break;case"random":r=0,o=100}return u([r,o])}function r(e,t){switch(t.format){case"hsvArray":return e;case"hslArray":return h(e);case"hsl":var n=h(e);return"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)";case"hsla":var r=h(e);return"hsla("+r[0]+", "+r[1]+"%, "+r[2]+"%, "+Math.random()+")";case"rgbArray":return g(e);case"rgb":var a=g(e);return"rgb("+a.join(", ")+")";case"rgba":var o=g(e);return"rgba("+o.join(", ")+", "+Math.random()+")";default:return s(e)}}function a(e,t){for(var n=l(e).lowerBounds,r=0;r<n.length-1;r++){var a=n[r][0],o=n[r][1],i=n[r+1][0],u=n[r+1][1];if(t>=a&&i>=t){var s=(u-o)/(i-a),c=o-s*a;return s*t+c}}return 0}function o(e){if("number"==typeof parseInt(e)){var t=parseInt(e);if(360>t&&t>0)return[t,t]}if("string"==typeof e&&d[e]){var n=d[e];if(n.hueRange)return n.hueRange}return[0,360]}function i(e){return l(e).saturationRange}function l(e){e>=334&&360>=e&&(e-=360);for(var t in d){var n=d[t];if(n.hueRange&&e>=n.hueRange[0]&&e<=n.hueRange[1])return d[t]}return"Color not found"}function u(e){if(null===p)return Math.floor(e[0]+Math.random()*(e[1]+1-e[0]));var t=e[1]||1,n=e[0]||0;p=(9301*p+49297)%233280;var r=p/233280;return Math.floor(n+r*(t-n))}function s(e){function t(e){var t=e.toString(16);return 1==t.length?"0"+t:t}var n=g(e),r="#"+t(n[0])+t(n[1])+t(n[2]);return r}function c(e,t,n){var r=n[0][0],a=n[n.length-1][0],o=n[n.length-1][1],i=n[0][1];d[e]={hueRange:t,lowerBounds:n,saturationRange:[r,a],brightnessRange:[o,i]}}function f(){c("monochrome",null,[[0,0],[100,0]]),c("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),c("orange",[19,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),c("yellow",[47,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),c("green",[63,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),c("blue",[179,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),c("purple",[258,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),c("pink",[283,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function g(e){var t=e[0];0===t&&(t=1),360===t&&(t=359),t/=360;var n=e[1]/100,r=e[2]/100,a=Math.floor(6*t),o=6*t-a,i=r*(1-n),l=r*(1-o*n),u=r*(1-(1-o)*n),s=256,c=256,f=256;switch(a){case 0:s=r,c=u,f=i;break;case 1:s=l,c=r,f=i;break;case 2:s=i,c=r,f=u;break;case 3:s=i,c=l,f=r;break;case 4:s=u,c=i,f=r;break;case 5:s=r,c=i,f=l}var g=[Math.floor(255*s),Math.floor(255*c),Math.floor(255*f)];return g}function h(e){var t=e[0],n=e[1]/100,r=e[2]/100,a=(2-n)*r;return[t,Math.round(n*r/(1>a?a:2-a)*1e4)/100,a/2*100]}function v(e){for(var t=0,n=0;n!==e.length&&!(t>=Number.MAX_SAFE_INTEGER);n++)t+=e.charCodeAt(n);return t}var p=null,d={};f();var m=function(a){if(a=a||{},a.seed&&a.seed===parseInt(a.seed,10))p=a.seed;else if("string"==typeof a.seed)p=v(a.seed);else{if(void 0!==a.seed&&null!==a.seed)throw new TypeError("The seed value must be an integer");p=null}var o,i,l;if(null!==a.count&&void 0!==a.count){var u=a.count,s=[];for(a.count=null;u>s.length;)p&&a.seed&&(a.seed+=1),s.push(m(a));return a.count=u,s}return o=e(a),i=t(o,a),l=n(o,i,a),r([o,i,l],a)};return m});var imageFileExtensions=["svg","png"],stackOverflowUserId=170309,stackOverflowTagCount=6,stackOverflowMaxTagAgeInMonths=12,jsFiddleUserId="sfarbota",jsFiddleTagCount=4,totalTagCount=0,minContainerR=100,minBallPercentageOfContainerR=.15,maxBallPercentageOfContainerR=.35,speedPercentageOfContainerR=.003,container=document.getElementById("current-areas-of-focus-container"),containerRect=container.getBoundingClientRect(),containerParentRect=container.parentElement.getBoundingClientRect(),mainFooterRect=$("#main-footer")[0].getBoundingClientRect(),containerHeight=mainFooterRect.top-containerParentRect.bottom,containerWidth=containerRect.right-containerRect.left;minContainerR=minContainerR>containerWidth?containerWidth:minContainerR;var containerR=(containerWidth>containerHeight?containerHeight:containerWidth)/2;containerR=minContainerR>containerR?minContainerR:containerR;var speed=speedPercentageOfContainerR*containerR,textSize=containerR/20,textLineSpacing=containerR/20,svgNamespace="http://www.w3.org/2000/svg",svg=document.createElementNS(svgNamespace,"svg");svg.id="svg-wrapper",$("#current-areas-of-focus-container").append(svg);var balls=[];calculateTotalTagCount(),getStackOverflowTags(),getJSFiddleTags();